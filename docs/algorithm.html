<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Group 7 Algorithm</title>
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
    </head>
    <body>
        <header>
           <h1>Datalogical Thinking Project: Just Google it</h1>
         <nav>
         
                <a href="index.html">Home</a>
                <a href="dataset.html">Dataset</a>
                <a class="active" href="algorithm.html">Algorithm</a>
                <a href="output.html">Output</a>
                <a href="discussion.html">Discussion</a>
                <a href="people.html">People</a>
                <a href="report.html">Report</a>
           
        </nav>
        </header>
        <main>
            <article>
                <h2>Our algorithm</h2>
                <code>
import pandas as pd<br>
from wordcloud import WordCloud, ImageColorGenerator<br>
import base64<br>
from io import BytesIO<br>
import matplotlib.pyplot as plt<br>
from collections import Counter<br>
import re<br>
<br>
# Read the dataset from CSV<br>
df = pd.read_csv('NewsDB-Python/datasets/dataset.csv')<br>
<br>
# Initialize removed keywords list<br>
removed_keywords = []<br>
<br>
# Interactive keyword exclusion process<br>
top_5_keywords = []<br>
while True:<br>
    # Task 1: Display top 5 keywords and their frequencies<br>
    if not top_5_keywords:  # If the top 5 keywords are not yet populated<br>
        all_keywords = df['Keywords'].str.split(';').explode().str.strip()<br>
        keyword_counts = all_keywords.value_counts().head(5)<br>
        top_5_keywords = keyword_counts.index.tolist()<br>
    else:  # If we already have top 5 keywords, remove those that the user has marked for removal<br>
        all_keywords = df['Keywords'].str.split(';').explode().str.strip()<br>
        keyword_counts = all_keywords.value_counts()<br>
        top_5_keywords = [keyword for keyword, count in keyword_counts.items() if keyword not in removed_keywords][:5]<br>
    <br>
    print("\nCurrent Top Keywords and Their Frequencies:")<br>
    for idx, keyword in enumerate(top_5_keywords):<br>
        print(f"{idx + 1}. {keyword}")<br>
<br>
    user_input = input("Enter the number of the keyword you want to remove (comma-separated if multiple), or 'done' to finish: ")
    if user_input.lower() == 'done':
        break
    try:
        to_remove = [int(num) - 1 for num in user_input.split(',')]
        removed_keywords.extend([top_5_keywords[i] for i in to_remove])
        top_5_keywords = [keyword for keyword in top_5_keywords if keyword not in removed_keywords]
    except ValueError:
        print("Invalid input. Please enter the number(s) of the keyword you want to remove.")

# Task 2: Articles matching the top 5 keywords after removal
keywords_set = set(top_5_keywords)  # Use the remaining keywords
articles_top_keywords = df[df['Keywords'].apply(lambda x: any(keyword in x for keyword in keywords_set))] # filter articles where at least one keyword is found in 'Keywords' column 
print("Number of articles matching top 5 keywords:", len(articles_top_keywords))


# Task 3: Identify authors discussing the top 5 keywords after removal
author_articles = []  # list to store relevant information from each article
for index, row in df.iterrows():  # iterate through rows of dataframe df
    for keyword in top_5_keywords: # for every keyword in top 5 remaining keywords
        if str(keyword) in row['Keywords']: # check if the keyword is present in 'Keywords' column of current row
            author_articles.append({  # if so, add relevant info to author_articles list
                'Keyword': keyword,
                'Author': row['Author'],
                'Title': row['Title'], 
                'URL': row['Permalink'],
                'Description': row['Description'] # 'Description': row['Description'][:250]  # Uncomment this line to limit description length to first 250 characters
            })
author_articles = [dict(t) for t in {tuple(d.items()) for d in author_articles}]  # Remove duplicates by converting to set and back to list

# Task 4: Word cloud based on descriptions of articles matching the remaining top 5 keywords
descriptions_top_keywords = ' '.join(articles_top_keywords['Description'].dropna()) # join all descriptions in a single string, dropping NaNs
wordcloud = WordCloud(width=1200, height=960).generate(descriptions_top_keywords)  # generate word cloud with the joined descriptions
plt.figure(figsize=(8, 4))
plt.imshow(wordcloud, interpolation='bilinear')
plt.axis('off')
svg_image = BytesIO()
plt.savefig(svg_image, format='svg') # Save word cloud as svg image
encoded_svg = base64.b64encode(svg_image.getvalue()).decode()  # Encoding the svg image to display in HTML report
wordcloud_svg = f"&lt;img src='data:image/svg+xml;base64,{encoded_svg}' width='1200' height='960'/&gt;" 
with open("NewsDB-Python/reports/Descriptions_word_cloud.html", "w") as f: # Save image in html report
    f.write(wordcloud_svg)
print("Word cloud saved to NewsDB-Python/reports/Descriptions_word_cloud.html") 

# Output keyword analysis report in Markdown format
report_md = f"# Keyword Analysis Report\n## TASK 1: Display the top five keywords and their frequencies.\n### Which five keywords occur most frequently in the dataset?\n\n"
for keyword in top_5_keywords:  # Output the remaining keywords
    report_md += f"{top_5_keywords.index(keyword) + 1}. {keyword}\n\n"
report_md += "## TASK 2: Articles matching the top five keywords\n### Which articles match the five most frequently occurring keywords?\n\n"
report_md += f"&lt;ol&gt;"
for index, row in articles_top_keywords.iterrows():  # Output titles, authors and descriptions of relevant articles
    report_md += f"&lt;li&gt;\n\n"
    report_md += f"---\n\n"
    report_md += f"**Keyword**: {row['Keywords']}\n\n"
    # report_md += f"{top_5_keywords(keyword)}\n\n"
    report_md += f"\n\n"
    report_md += f"**Title**: &lt;a href='{row['Permalink']}'&gt;{row['Title']}&lt;/a&gt;\n" 
    report_md += f"\n\n"    
    report_md += f"**Author**: {row['Author']}\n"
    report_md += f"\n\n"    
    report_md += f"**Description**: {row['Description']}\n\n"
    report_md += f"&lt;/li&gt;"
report_md += f"&lt;/ol&gt;\n\n" 
report_md += "## TASK 3: Identify authors discussing the top five keywords\n### Which authors discuss the top five keywords?\n\n"
report_md += f"&lt;ol&gt;"
for article in author_articles:  # Output relevant info from each article in author_articles list
    report_md += f"&lt;li&gt;\n\n"
    report_md += f"---\n\n"    
    report_md += f"- **Keyword**: {article['Keyword']}\n"   
    report_md += f"- **Author**: {article['Author']}\n"
    report_md += f"- **Title**: &lt;a href='{article['URL']}'&gt;{article['Title']}&lt;/a&gt;\n" 
    report_md += f"- **Description**: {article['Description']}\n\n"  
    report_md += f"&lt;/li&gt;"
report_md += f"&lt;/ol&gt;\n\n" 
report_md += "## TASK 4: Word cloud based on descriptions of all articles in the dataset\n\n"
report_md += f"![image](NewsDB-Python/reports/Descriptions_word_cloud.svg)\n"
with open("NewsDB-Python/reports/keyword_analysis_report.md", "w") as f:  # Save markdown report 
    f.write(report_md)
print("Markdown report saved to NewsDB-Python/reports/keyword_analysis_report.md")


# Output keyword analysis report in HTML format
html_template = """&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;link href="style_article.css" rel="stylesheet"&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Keyword Analysis Report&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Keyword Analysis Report&lt;/h1&gt;
&lt;h2&gt;TASK 1: Display the top five keywords and their frequencies. &lt;/h2&gt;
&lt;h4&gt;Which five keywords occur most frequently in the dataset?&lt;/h4&gt;
&lt;ol&gt;{keywords}&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;TASK 2: Articles matching the top five keywords&lt;/h2&gt;
&lt;h4&gt;Which articles match the five most frequently occurring keywords&lt;/h4&gt;
&lt;ol&gt;{articles}&lt;/ol&gt;
&lt;hr&gt;
&lt;h2&gt;TASK 3: Identify authors discussing the top five keywords&lt;/h2&gt;
&lt;h4&gt;Which authors discuss the top five keywords?&lt;/h4&gt;
{author_articles}
&lt;hr&gt;
&lt;h2&gt;TASK 4: Word cloud based on descriptions of all articles in the dataset&lt;/h2&gt;
&lt;div&gt;{wordcloud}&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;"""  # HTML template with placeholders for various parts of report
keywords = "\n".join(f'&lt;li&gt;{keyword}&lt;/li&gt;' for keyword in top_5_keywords) 
articles = "\n".join(f'&lt;h3&gt;Keyword: {article["Keyword"]}&lt;/h3&gt;&lt;p&gt;&lt;a href="{row["Permalink"]}"&gt;{row["Title"]}&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;strong&gt;{row["Author"]}:&lt;/strong&gt; {row["Description"]}&lt;/p&gt;&lt;br&gt;&lt;br&gt;' for index, row in articles_top_keywords.iterrows())  
author_articles = "\n".join(f'&lt;h3&gt;Keyword: {article["Keyword"]}&lt;/h3&gt;&lt;p&gt;Author: {article["Author"]}&lt;/p&gt;&lt;p&gt;Title: &lt;a href="{article["URL"]}"&gt;{article["Title"]}&lt;/a&gt;&lt;/p&gt;&lt;p&gt;Description: {article["Description"]}&lt;/p&gt;' for article in author_articles)  
output = html_template.format(keywords=keywords, articles=articles, wordcloud=wordcloud_svg, author_articles=author_articles) # Format the HTML template with the actual data
with open('NewsDB-Python/reports/report.html', 'w') as f:  # Save the html report 
    f.write(output)
print("HTML report saved to NewsDB-Python/reports/report.html")   

                </code>
            </article>
        </main>
       <footer>
            <div id="footer">
               <div class="copyright">
                  <div><a href="https://creativecommons.org/licenses/by/4.0/legalcode"><img src="img/cc.svg" class="copyright_logo" alt="Creative Commons License"><img src="img/by.svg" class="copyright_logo" alt="Attribution 4.0 International"></a></div>
                  <div>
                     2024 Klara Chlupata, Einar Hannerz, Andre Rodewald and Victor Villavicencio.
                     </div>
               </div>
            </div>
         </footer>
    </body>
</html>
